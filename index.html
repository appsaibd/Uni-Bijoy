<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bijoy to Unicode Converter | Bijoy.Abswer.com</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Bengali:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans Bengali', sans-serif;
            background-color: #f0fdf4; /* Very light emerald tint */
        }
        /* Bijoy font simulation */
        .bijoy-font {
            font-family: 'SutonnyMJ', 'SutonnyOMJ', 'SolaimanLipi', sans-serif;
        }
        textarea {
            font-size: 1.1rem;
            line-height: 1.6;
        }
        ::selection {
            background: #059669;
            color: white;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- Navbar -->
    <nav class="bg-white border-b border-emerald-100 sticky top-0 z-50 shadow-sm">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <!-- Logo Section -->
            <a href="https://bijoy.abswer.com" class="flex items-center gap-3 hover:opacity-90 transition">
                <!-- Using Raw GitHub URL for the image to display correctly -->
                <img src="https://raw.githubusercontent.com/appsaibd/Uni-Bijoy/main/abswer.com.gif" alt="AbsWer Bijoy" class="h-10 md:h-12 object-contain">
                <div class="hidden md:block">
                    <span class="block text-lg font-bold text-gray-800 leading-none">bijoy.abswer.com</span>
                    <span class="text-xs text-emerald-600 font-medium">বাংলা কনভার্টার টুল</span>
                </div>
            </a>
            
            <div class="flex items-center gap-3">
                <a href="https://www.abswer.com" target="_blank" class="flex items-center gap-2 text-sm bg-emerald-50 hover:bg-emerald-100 text-emerald-700 px-4 py-2 rounded-full transition border border-emerald-200 font-medium">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
                    </svg>
                    মূল সাইট (abswer.com)
                </a>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="flex-grow container mx-auto px-4 py-8">
        
        <div class="bg-white rounded-2xl shadow-xl border border-emerald-50 p-6 md:p-8 max-w-6xl mx-auto">
            
            <!-- Tabs / Mode Selection -->
            <div class="flex justify-center mb-8">
                <div class="inline-flex bg-emerald-50 p-1.5 rounded-xl border border-emerald-100">
                    <button id="tabUniToBijoy" onclick="switchMode('u2b')" class="flex items-center gap-2 px-6 py-2.5 rounded-lg text-sm font-bold transition-all bg-emerald-600 text-white shadow-md">
                        <span>ইউনিকোড</span>
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" /></svg>
                        <span>বিজয়</span>
                    </button>
                    <button id="tabBijoyToUni" onclick="switchMode('b2u')" class="flex items-center gap-2 px-6 py-2.5 rounded-lg text-sm font-bold text-gray-600 hover:text-emerald-700 hover:bg-emerald-100 transition-all">
                        <span>বিজয়</span>
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" /></svg>
                        <span>ইউনিকোড</span>
                    </button>
                </div>
            </div>

            <!-- Input/Output Area -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-8">
                
                <!-- Input Box -->
                <div class="flex flex-col gap-3">
                    <div class="flex justify-between items-end">
                        <label id="inputLabel" class="font-bold text-gray-700 text-lg">
                            ইউনিকোড কিবোর্ড (Unicode)
                        </label>
                        <span class="text-xs text-emerald-600 bg-emerald-50 px-2 py-1 rounded-md border border-emerald-100">ইনপুট</span>
                    </div>
                    
                    <div class="relative group">
                        <textarea id="inputText" class="w-full h-80 p-5 border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-emerald-500/20 focus:border-emerald-500 transition resize-none shadow-sm outline-none" placeholder="এখানে লিখুন বা পেস্ট করুন..."></textarea>
                        
                        <!-- Floating Actions -->
                        <div class="absolute top-3 right-3 flex gap-2">
                            <button onclick="pasteText()" class="p-2 bg-white text-gray-500 hover:text-emerald-600 rounded-lg shadow-sm border border-gray-200 hover:border-emerald-300 transition" title="Paste">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" /></svg>
                            </button>
                            <button onclick="clearText('inputText')" class="p-2 bg-white text-gray-500 hover:text-red-500 rounded-lg shadow-sm border border-gray-200 hover:border-red-200 transition" title="Clear">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                            </button>
                        </div>
                    </div>
                    <div class="text-right text-xs font-medium text-gray-400" id="charCount">0 characters</div>
                </div>

                <!-- Controls (Mobile Only) -->
                <div class="md:hidden flex justify-center items-center -my-2">
                    <button onclick="doConvert()" class="bg-emerald-600 text-white p-3 rounded-full shadow-lg hover:bg-emerald-700 active:scale-95 transition ring-4 ring-white">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3" />
                        </svg>
                    </button>
                </div>

                <!-- Output Box -->
                <div class="flex flex-col gap-3">
                    <div class="flex justify-between items-end">
                        <label id="outputLabel" class="font-bold text-gray-700 text-lg">
                            বিজয় আউটপুট (Bijoy ANSI)
                        </label>
                        <span class="text-xs text-emerald-600 bg-emerald-50 px-2 py-1 rounded-md border border-emerald-100">ফলাফল</span>
                    </div>

                    <div class="relative group">
                        <textarea id="outputText" readonly class="w-full h-80 p-5 bg-gray-50 border-2 border-gray-200 rounded-xl focus:outline-none resize-none text-gray-700" placeholder="ফলাফল এখানে আসবে..."></textarea>
                        
                        <button onclick="copyToClipboard()" class="absolute top-3 right-3 bg-white text-emerald-700 border border-emerald-200 hover:bg-emerald-600 hover:text-white px-4 py-2 rounded-lg text-sm font-bold shadow-sm transition flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" /></svg>
                            কপি করুন
                        </button>
                    </div>
                </div>
            </div>

            <!-- Advanced Tools -->
            <div class="mt-4 flex flex-col items-end gap-2">
                 <button onclick="fixBrokenWords()" class="text-sm bg-amber-100 text-amber-800 hover:bg-amber-200 border border-amber-200 px-5 py-2.5 rounded-full transition flex items-center gap-2 font-semibold shadow-sm">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                    </svg>
                    বিজয় ভাঙ্গা শব্দ ঠিক করতে ক্লিক করুন
                </button>
            </div>

            <!-- Main Action Buttons -->
            <div class="mt-8 flex flex-col sm:flex-row gap-4 justify-center pt-8 border-t border-dashed border-gray-200">
                <button onclick="doConvert()" class="flex-1 sm:flex-none bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-3.5 px-10 rounded-xl shadow-lg shadow-emerald-200 transform hover:-translate-y-0.5 active:scale-95 transition-all text-lg flex items-center justify-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                    </svg>
                    কনভার্ট করুন
                </button>
                <button onclick="clearAll()" class="flex-1 sm:flex-none bg-gray-100 hover:bg-gray-200 text-gray-700 font-bold py-3.5 px-10 rounded-xl shadow-sm border border-gray-200 active:scale-95 transition-all text-lg">
                    সব মুছুন
                </button>
            </div>
            
            <!-- Instructions -->
            <div class="mt-8 p-5 bg-blue-50 border border-blue-100 rounded-xl text-blue-800 text-sm flex items-start gap-3">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 flex-shrink-0 mt-0.5 text-blue-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <div>
                    <strong class="block mb-1 text-blue-900">কিভাবে ব্যবহার করবেন?</strong>
                    <ul class="list-disc list-inside space-y-1 opacity-90">
                        <li>বিজয় ফন্টের লেখা সঠিকভাবে দেখার জন্য আপনার ডিভাইসে 'SutonnyMJ' ফন্ট থাকা প্রয়োজন।</li>
                        <li>কনভার্ট করার পর লেখাটি কপি করে মাইক্রোসফট ওয়ার্ড বা ফটোশপে পেস্ট করুন।</li>
                        <li>যদি কোনো শব্দ ভেঙ্গে যায়, তবে হলুদ রঙের "বিজয় ভাঙ্গা শব্দ ঠিক করুন" বাটনে ক্লিক করুন।</li>
                    </ul>
                </div>
            </div>

        </div>
    </main>

    <footer class="bg-gray-800 border-t border-gray-700 text-gray-400 py-8">
        <div class="container mx-auto px-4 text-center">
            <p class="mb-2 text-lg font-semibold text-gray-200">Bijoy.Abswer.com</p>
            <p class="text-sm opacity-75">&copy; 2025 Bangla Converter Tool. Powered by <a href="https://www.abswer.com" class="text-emerald-400 hover:text-emerald-300 transition" target="_blank">Abswer.com</a>.</p>
        </div>
    </footer>

    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-8 right-1/2 transform translate-x-1/2 md:translate-x-0 md:right-8 bg-gray-800 text-white px-6 py-3 rounded-full shadow-2xl translate-y-24 opacity-0 transition-all duration-300 z-50 flex items-center gap-2 font-medium">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-emerald-400" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
        </svg>
        <span>টেক্সট কপি করা হয়েছে!</span>
    </div>

    <!-- Logic Script -->
    <script>
        let currentMode = 'u2b'; // u2b or b2u

        function switchMode(mode) {
            currentMode = mode;
            const tabU2B = document.getElementById('tabUniToBijoy');
            const tabB2U = document.getElementById('tabBijoyToUni');
            const inputLabel = document.getElementById('inputLabel');
            const outputLabel = document.getElementById('outputLabel');
            const inputText = document.getElementById('inputText');
            const outputText = document.getElementById('outputText');

            // Swap contents logic
            let temp = inputText.value;
            inputText.value = outputText.value;
            outputText.value = temp;

            if (mode === 'u2b') {
                tabU2B.className = "flex items-center gap-2 px-6 py-2.5 rounded-lg text-sm font-bold transition-all bg-emerald-600 text-white shadow-md";
                tabB2U.className = "flex items-center gap-2 px-6 py-2.5 rounded-lg text-sm font-bold text-gray-600 hover:text-emerald-700 hover:bg-emerald-100 transition-all";
                inputLabel.innerHTML = 'ইউনিকোড কিবোর্ড (Unicode)';
                outputLabel.innerHTML = 'বিজয় আউটপুট (Bijoy ANSI)';
                inputText.classList.remove('bijoy-font');
                outputText.classList.add('bijoy-font');
            } else {
                tabU2B.className = "flex items-center gap-2 px-6 py-2.5 rounded-lg text-sm font-bold text-gray-600 hover:text-emerald-700 hover:bg-emerald-100 transition-all";
                tabB2U.className = "flex items-center gap-2 px-6 py-2.5 rounded-lg text-sm font-bold transition-all bg-emerald-600 text-white shadow-md";
                inputLabel.innerHTML = 'বিজয় কিবোর্ড (Bijoy)';
                outputLabel.innerHTML = 'ইউনিকোড আউটপুট (Unicode)';
                inputText.classList.add('bijoy-font');
                outputText.classList.remove('bijoy-font');
            }
        }

        function clearText(id) {
            document.getElementById(id).value = '';
            document.getElementById('charCount').innerText = '0 characters';
        }

        async function pasteText() {
            try {
                const text = await navigator.clipboard.readText();
                document.getElementById('inputText').value += text;
                doConvert();
            } catch (err) {
                // Fallback or permission denied
                console.error('Paste failed', err);
            }
        }

        function clearAll() {
            document.getElementById('inputText').value = '';
            document.getElementById('outputText').value = '';
            document.getElementById('charCount').innerText = '0 characters';
        }

        document.getElementById('inputText').addEventListener('input', function() {
            document.getElementById('charCount').innerText = this.value.length + ' characters';
            doConvert(); 
        });

        function copyToClipboard() {
            const copyText = document.getElementById("outputText");
            copyText.select();
            copyText.setSelectionRange(0, 99999);
            document.execCommand("copy");
            showToast("টেক্সট কপি করা হয়েছে!");
        }

        function showToast(msg) {
            const toast = document.getElementById('toast');
            toast.querySelector('span').innerText = msg;
            toast.classList.remove('translate-y-24', 'opacity-0');
            setTimeout(() => {
                toast.classList.add('translate-y-24', 'opacity-0');
            }, 2000);
        }

        function fixBrokenWords() {
            let outputField = document.getElementById('outputText');
            let text = outputField.value;
            
            if (!text) {
                showToast("আউটপুট বক্সে কোনো লেখা নেই!");
                return;
            }

            if (currentMode === 'u2b') {
                // Bijoy fixes
                text = text.replace(/†/g, '‡'); // Normalize E-kar
                // Swap E-kar if placed after (Common error)
                text = text.replace(/([A-Z_a-z])(‡)/g, "$2$1"); 
                // Fix O-Kar construction issues
                text = text.replace(/‡([A-Z_a-z])v/g, "‡$1v"); // Ensure format
            } else {
                // Unicode fixes
                text = text.replace(/ে([ক-হড়-য়ৎংঃঁ]+)া/g, "ো$1"); 
                text = text.replace(/ে\u200D?া/g, 'ো'); 
                text = text.replace(/ে\u200D?ৗ/g, 'ৌ');
                text = text.replace(/([ক-হড়-য়ৎ])([া-ৌ])([্])/g, "$1$3$2"); 
                // Fix Reph issues
                text = text.replace(/([ক-হড়-য়ৎ])র্/g, "র্$1"); 
            }
            outputField.value = text;
            showToast("ভাঙ্গা শব্দ ঠিক করা হয়েছে!");
        }

        // --- POWERFUL CONVERSION LOGIC ---

        function doConvert() {
            const input = document.getElementById('inputText').value;
            let output = '';
            if (currentMode === 'u2b') {
                output = UnicodeToBijoy(input);
            } else {
                output = BijoyToUnicode(input);
            }
            document.getElementById('outputText').value = output;
        }

        // Expanded Mappings
        const u2b_map = {
            'অ': 'A', 'আ': 'Av', 'ই': 'B', 'ঈ': 'C', 'উ': 'D', 'ঊ': 'E', 'ঋ': 'F',
            'এ': 'G', 'ঐ': 'H', 'ও': 'I', 'ঔ': 'J',
            'ক': 'K', 'খ': 'L', 'গ': 'M', 'ঘ': 'N', 'ঙ': 'O',
            'চ': 'P', 'ছ': 'Q', 'জ': 'R', 'ঝ': 'S', 'ঞ': 'T',
            'ট': 'U', 'ঠ': 'V', 'ড': 'W', 'ঢ': 'X', 'ণ': 'Y',
            'ত': 'Z', 'থ': '_', 'দ': '`', 'ধ': 'a', 'ন': 'b',
            'প': 'c', 'ফ': 'd', 'ব': 'e', 'ভ': 'f', 'ম': 'g',
            'য': 'h', 'র': 'i', 'ল': 'j', 'শ': 'k', 'ষ': 'l', 'স': 'm', 'হ': 'n',
            'ড়': 'p', 'ঢ়': 'q', 'য়': 'r', 'ৎ': 't',
            'া': 'v', 'ি': 'w', 'ী': 'x', 'ু': 'y', 'ূ': 'z', 'ৃ': '“',
            'ে': '‡', 'ৈ': 'ˆ', 'ো': '‡v', 'ৌ': '‡Š', 
            'ং': 's', 'ঃ': ':', 'ঁ': 'u', '্': '&', '।': '|',
            '০': '0', '১': '1', '২': '2', '৩': '3', '৪': '4', '৫': '5', '৬': '6', '৭': '7', '৮': '8', '৯': '9'
        };

        const b2u_map = {
            'A': 'অ', 'Av': 'আ', 'B': 'ই', 'C': 'ঈ', 'D': 'উ', 'E': 'ঊ', 'F': 'ঋ',
            'G': 'এ', 'H': 'ঐ', 'I': 'ও', 'J': 'ঔ',
            'K': 'ক', 'L': 'খ', 'M': 'গ', 'N': 'ঘ', 'O': 'ঙ',
            'P': 'চ', 'Q': 'ছ', 'R': 'জ', 'S': 'ঝ', 'T': 'ঞ',
            'U': 'ট', 'V': 'ঠ', 'W': 'ড', 'X': 'ঢ', 'Y': 'ণ',
            'Z': 'ত', '_': 'থ', '`': 'দ', 'a': 'ধ', 'b': 'ন',
            'c': 'প', 'd': 'ফ', 'e': 'ব', 'f': 'ভ', 'g': 'ম',
            'h': 'য', 'i': 'র', 'j': 'ল', 'k': 'শ', 'l': 'ষ',
            'm': 'স', 'n': 'হ', 'p': 'ড়', 'q': 'ঢ়', 'r': 'য়', 't': 'ৎ',
            'v': 'া', 'w': 'ি', 'x': 'ী', 'y': 'ু', 'z': 'ূ', '“': 'ৃ',
            '‡': 'ে', 'ˆ': 'ৈ', '†': 'ে', '&': 'ঁ', 's': 'ং', ':': 'ঃ', '|': '।',
            '0': '০', '1': '১', '2': '২', '3': '৩', '4': '৪', '5': '৫', '6': '৬', '7': '৭', '8': '৮', '9': '৯'
        };

        // Massive List of Bijoy Conjuncts to prevent breaking
        // This is the "Power" part
        const bijoy_conjuncts = {
            '¯’': 'স্থ', '¯§': 'স্ম', '¯^': 'স্ব', '¯‹': 'স্ক', '¯Í': 'স্ত', '¯’': 'স্থ',
            '¯Ív': 'স্তা', '¯’v': 'স্থা', '¯^v': 'স্বা', '¯—': 'স্ত', 
            'eŸ': 'ব্ব', 'e−': 'ব্ল', 'e¨': 'ব্য', 'eª': 'ব্র', 'eR': 'ব্জ', 'eØ': 'ব্দ',
            'bœ': 'ন্ন', 'b¡': 'ন্ব', 'b¥': 'ন্ম', 'šÍ': 'ন্ত', 'š’': 'ন্থ', '›`': 'ন্দ', 
            '›a': 'ন্ধ', 'š¿': 'ন্ত্র', '©': 'র্',
            'K¬': 'ক্ল', 'K¨': 'ক্য', 'Kª': 'ক্র', 'P©': 'র্চ', 'P¨': 'চ্য', 'Q¨': 'ছ্য',
            'R¨': 'জ্য', 'Rª': 'জ্র', 'T¨': 'ঞ্য', 'U¨': 'ট্য', 'Uª': 'ট্র', 'W¨': 'ড্য', 'Wª': 'ড্র',
            'X¨': 'ঢ্য', 'Y¨': 'ণ্য', 'Z¡': 'ত্ব', 'Z¨': 'ত্য', 'Î': 'ত্র', 'Zª': 'ত্র',
            '_¨': 'থ্য', '`¨': 'দ্য', '`ª': 'দ্র', '`ªæ': 'দ্রু', 'a¨': 'ধ্য', 'aª': 'ধ্র',
            'b¨': 'ন্য', 'c¨': 'প্য', 'cÖ': 'প্র', 'c−': 'প্ল', 'd¨': 'ফ্য', 'dª': 'ফ্র', 'd¬': 'ফ্ল',
            'e¨': 'ব্য', 'f¨': 'ভ্য', 'fª': 'ভ্র', 'g¨': 'ম্য', 'gª': 'ম্র', 'l¨': 'ষ্য',
            'm¨': 'স্য', 'mª': 'স্র', 'n¨': 'হ্য', 'nª': 'হ্র', 'n−': 'হ্ল',
            '¾': 'জ্ঞ', '²': 'ক্ষ', 'ÿ': 'ক্ষ', '·': 'ক্স', 'µ': 'ক্র', 'Mª': 'গ্র', 'M−': 'গ্ল',
            '¼': 'ঙ্ক', '•N': 'ঙ্ঘ', '½': 'ঙ্গ', 'nj': 'ল্ক', 'k¨': 'শ্য', 'kª': 'শ্র', 'k−': 'শ্ল',
            '®‹': 'ষ্ক', '®‹i': 'ষ্কর', 'ó': 'ষ্ট', 'ò': 'ষ্ঠ', '®ú': 'ষ্প', 'b¥': 'ন্ম', 
            'gw›`i': 'মন্দির', '¯^vgx': 'স্বামী', '¯‹zj': 'স্কুল', 'Avmbœ': 'আসন্ন',
            'mÜ¨v': 'সন্ধ্যা', 'cixÿv': 'পরীক্ষা', 'Dò': 'উষ্ণ', 'K…ò': 'কৃষ্ণ',
            'wkÿK': 'শিক্ষক', 'QvÎ': 'ছাত্র', 'weÁvb': 'বিজ্ঞান', 'Á': 'জ্ঞ', 
            'Ä': 'ঞ্জ', 'Å': 'ঞ্চ', 'Æ': 'ঞ্ছ', 'Ç': 'ণ্ড', 'È': 'ণ্ঠ',
            'Í': 'ন্ত', 'Î': 'ত্র', 'Ï': 'দ্ধ', 'Ð': 'ণ্ট', 'Ñ': 'ণ্ড'
        };

        function UnicodeToBijoy(text) {
            if (!text) return '';
            let str = text;

            // 1. Pre-Processing Reph (Ref)
            // Unicode: Reph (্+র) comes BEFORE char. Bijoy: Reph char is usually typed/mapped AFTER base.
            // But wait, standard conversion logic:
            // Input: র্ক (ka + halant + ra)? No, Ra + Halant + Ka.
            // Unicode Reph: \u09B0 \u09CD (Ra + Halant).
            // Logic: Move Reph from BEFORE consonant to AFTER consonant (and map to ©)
            // Regex match: (Ra+Halant)(Consonant) -> (Consonant)©
            str = str.replace(/\u09B0\u09CD([^\u09BE-\u09CC\u09CD\u09D7]+)/g, "$1©");
            
            // 2. Pre-kar Reordering (Unicode Post-Char -> Bijoy Pre-Char)
            // Unicode: ক + ে -> Bijoy: ে + ক
            // Move ি, ে, ৈ BEFORE the Consonant
            str = str.replace(/([ক-হড়-য়ৎ])([িেৈ])/g, "$2$1");

            // 3. Handle 'O-Kar' & 'Ou-Kar' (Complex because they split)
            // Unicode ো maps to ‡v. But we just moved 'e-kar' (‡).
            // Wait, Unicode ো is a single character \u09CB.
            // Map ো -> ‡v (which is ‡ + char + v)
            // Since we reordered, we need to be careful.
            // Let's rely on direct char mapping for ো -> ‡v
            // But since ‡ is a pre-kar, it needs to wrap the consonant.
            // This simple logic is flawed for O-kar without a complex parser.
            // Trick: Replace ো with 'ে' + 'া' temporarily in Unicode?
            // Better: 
            str = str.replace(/([ক-হড়-য়ৎ])ো/g, "‡$1v");
            str = str.replace(/([ক-হড়-য়ৎ])ৌ/g, "‡$1Š");

            // 4. Main Mapping
            let result = '';
            for (let i = 0; i < str.length; i++) {
                let char = str[i];
                result += u2b_map[char] || char;
            }
            
            return result;
        }

        function BijoyToUnicode(text) {
            if (!text) return '';
            let str = text;

            // 0. Typography Normalization
            str = str.replace(/†/g, '‡'); // Normalize E-kar

            // 1. Apply Massive Conjunct List (The "Power" Step)
            // We iterate through the dictionary. Order matters (Longer first).
            // Sorting keys by length desc
            const sortedKeys = Object.keys(bijoy_conjuncts).sort((a, b) => b.length - a.length);
            
            for (let key of sortedKeys) {
                 // Escape regex special chars in key
                 let escapedKey = key.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&');
                 str = str.replace(new RegExp(escapedKey, 'g'), bijoy_conjuncts[key]);
            }

            // 2. Pre-Kar Reordering (Bijoy Pre-Char -> Unicode Post-Char)
            // PreKars: w (i), ‡ (e), ˆ (oi)
            // Pattern: (PreKar)(Consonant) -> (Consonant)(PreKarMapped)
            // Bijoy Consonants: A wide range.
            
            // We need a helper to swap.
            // Match (w|‡|ˆ) followed by (Any Bijoy Consonant Code or Conjunct placeholder?)
            // Since we already converted Conjuncts to Unicode chars, 
            // the "Consonant" might now be a Unicode Char!
            // Example: "w" + "kv" (sha) -> "w" + "শ" -> "শ" + "ি"
            
            // Logic: (w|‡|ˆ) + (Unicode Bengali Range or Bijoy ASCII Consonant)
            // Note: If we converted conjuncts, they are now Bengali.
            // If simple chars, they are still ASCII.
            
            // Regex to find PreKar + (BengaliChar OR ASCII Consonant)
            // ASCII Consonants: K-Z, a-z (excluding mapped vowels?)
            const consonantPattern = "[\u0980-\u09FFK-Z_`a-z]"; 
            
            str = str.replace(/(w|‡|ˆ)([\u0980-\u09FFK-Z_`a-z])/g, function(match, kar, cons) {
                // Map the kar to unicode
                let uniKar = '';
                if(kar === 'w') uniKar = 'ি';
                if(kar === '‡') uniKar = 'ে';
                if(kar === 'ˆ') uniKar = 'ৈ';
                
                return cons + uniKar;
            });

            // 3. Main Char Mapping
            let result = '';
            // We use split/join or loop. Since mixed content, loop is safer if careful.
            // But map logic is simple char replacement.
            
            // Note: Since we have mixed Unicode (from Step 1) and ASCII, we only map ASCII.
            for (let i = 0; i < str.length; i++) {
                let char = str[i];
                // If char is already Bengali (from conjuncts), keep it.
                if (char >= '\u0980' && char <= '\u09FF') {
                    result += char;
                } else {
                    result += b2u_map[char] || char;
                }
            }
            str = result;

            // 4. Post-Processing Fixes
            // O-Kar Fix: ে + া -> ো
            str = str.replace(/ে([^\u0980-\u09FF]*)া/g, "ো$1"); // Logic fail if chars between
            str = str.replace(/ো/g, "ো"); // Direct join
            str = str.replace(/ৌ/g, "ৌ"); // Ou-kar
            
            // Reph fix (Bijoy © mapped to র্ )
            // If we missed any ©
            str = str.replace(/©/g, "র্");

            return str;
        }
    </script>
</body>
</html>
